description = 'QMesyDAQ detector devices'

group = 'lowlevel'

tango_base = 'tango://spodictrl.spodi.frm2:10000/spodi/'
detector_base = 'tango://mesydaq.spodi.frm2.tum.de:10000/qm/qmesydaq/'

devices = dict(
    mon = device('nicos.devices.vendor.qmesydaq.tango.CounterChannel',
        description = 'HWB MON',
        tangodevice = detector_base + 'counter0',
        fmtstr = '%d',
        type = 'monitor',
        lowlevel = True,
    ),
    tim1 = device('nicos.devices.vendor.qmesydaq.tango.TimerChannel',
        description = 'HWB TIM1',
        tangodevice = detector_base + 'timer',
        fmtstr = '%.2f',
        unit = 's',
        lowlevel = True,
    ),
    image = device('nicos.devices.vendor.qmesydaq.tango.ImageChannel',
        description = 'Image data device',
        tangodevice = detector_base + 'image',
        fmtstr = '%d',
        pollinterval = None,
        lowlevel = True,
        transpose = True,
    ),
    basedet = device('nicos.devices.generic.Detector',
        description = 'Classical detector with single channels',
        timers = ['tim1'],
        monitors = ['mon'],
        images = ['image'],
        pollinterval = None,
        lowlevel = True,
    ),
    adet = device('nicos_mlz.spodi.devices.detector.Detector',
        description = 'Scanning (resolution steps) detector',
        motor = 'tths',
        detector = 'basedet',
        pollinterval = None,
        maxage = 86400,
        liveinterval = 5,
    ),
    hv_det = device('nicos.devices.tango.PowerSupply',
        description = 'Detector high voltage',
        tangodevice = tango_base + 'hv/detector',
        requires = {'level': 'admin'},
    ),
    hv_det_current = device('nicos.devices.generic.ReadonlyParamDevice',
        description = 'Detector high voltage current',
        device = 'hv_det',
        parameter = 'current',
    ),
    hv_mon = device('nicos.devices.tango.PowerSupply',
        description = 'Monitor high voltage',
        tangodevice = tango_base + 'hv/monitor',
        requires = {'level': 'admin'},
    ),
    hv_mon_current = device('nicos.devices.generic.ReadonlyParamDevice',
        description = 'Monitor high voltage current',
        device = 'hv_det',
        parameter = 'current',
    ),
    histogram = device('nicos_mlz.devices.qmesydaqsinks.HistogramSink',
        description = 'Histogram data written via QMesyDAQ',
        image = 'image',
    ),
    listmode = device('nicos_mlz.devices.qmesydaqsinks.ListmodeSink',
        description = 'Listmode data written via QMesyDAQ',
        image = 'image',
    ),
    detsampledist = device('nicos.devices.generic.ManualMove',
        description = 'Distance between sample and detector',
        default = 1.117,
        abslimits = (1.117, 1.117),
        unit = 'm',
    ),
)
